


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Metrics on TorchServe &mdash; PyTorch/Serve master documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/katex-math.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TorchServe REST API" href="rest_api.html" />
    <link rel="prev" title="Management API" href="management_api.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <div class="ecosystem-dropdown">
              <a id="dropdownMenuButton" data-toggle="ecosystem-dropdown">
                Ecosystem
              </a>
              <div class="ecosystem-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/hub"">
                  <span class=dropdown-title>Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem">
                  <span class=dropdown-title>Tools & Libraries</span>
                  <p>Explore the ecosystem of tools and libraries</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <div class="resources-dropdown">
              <a id="resourcesDropdownButton" data-toggle="resources-dropdown">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/resources"">
                  <span class=dropdown-title>Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class=dropdown-title>About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  master 
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Core APIs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="inference_api.html">Inference API</a></li>
<li class="toctree-l1"><a class="reference internal" href="default_handlers.html">TorchServe default inference handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging on Torchserve</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html#pre-requisites">Pre-requisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html#types-of-logs">Types of logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html#modifying-the-behavior-of-the-logs">Modifying the behavior of the logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html#enable-asynchronous-logging">Enable asynchronous logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="management_api.html">Management API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Metrics on TorchServe</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest_api.html">TorchServe REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Advanced configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">TorchServe Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="server.html">Running the TorchServe</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_inference_with_ts.html">Batch Inference with TorchServe</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_service.html">Custom Service</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Metrics on TorchServe</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/metrics.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="section" id="metrics-on-torchserve">
<h1>Metrics on TorchServe<a class="headerlink" href="#metrics-on-torchserve" title="Permalink to this headline">¶</a></h1>
<div class="section" id="contents-of-this-document">
<h2>Contents of this Document<a class="headerlink" href="#contents-of-this-document" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#introduction">Introduction</a></p></li>
<li><p><a class="reference external" href="#system-metrics">System metrics</a></p></li>
<li><p><a class="reference external" href="#formatting">Formatting</a></p></li>
<li><p><a class="reference external" href="#custom-metrics-api">Custom Metrics API</a></p></li>
<li><p><a class="reference external" href="#logging-the-custom-metrics">Logging the custom metrics</a></p></li>
</ul>
</div>
<div class="section" id="id1">
<h2>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>TorchServe collects system level metrics in regular intervals, and also provides an API for custom metrics to be collected. Metrics collected by metrics are logged and can be aggregated by metric agents.
The system level metrics are collected every minute. Metrics defined by the custom service code, can be collected per request or a batch of requests. TorchServe logs these two sets of metrics to different log files.
Metrics are collected by default at:</p>
<ul class="simple">
<li><p>System metrics - log_directory/ts_metrics.log</p></li>
<li><p>Custom metrics - log directory/model_metrics.log</p></li>
</ul>
<p>The location of log files and metric files can be configured at <a class="reference external" href="https://github.com/pytorch/serve/blob/master/frontend/server/src/main/resources/log4j.properties">log4j.properties</a> file.</p>
</div>
<div class="section" id="id2">
<h2>System Metrics<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Metric Name</p></th>
<th class="head"><p>Dimension</p></th>
<th class="head"><p>Unit</p></th>
<th class="head"><p>Semantics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPUUtilization</p></td>
<td><p>host</p></td>
<td><p>percentage</p></td>
<td><p>cpu utillization on host</p></td>
</tr>
<tr class="row-odd"><td><p>DiskAvailable</p></td>
<td><p>host</p></td>
<td><p>GB</p></td>
<td><p>disk available on host</p></td>
</tr>
<tr class="row-even"><td><p>DiskUsed</p></td>
<td><p>host</p></td>
<td><p>GB</p></td>
<td><p>disk used on host</p></td>
</tr>
<tr class="row-odd"><td><p>DiskUtilization</p></td>
<td><p>host</p></td>
<td><p>percentage</p></td>
<td><p>disk used on host</p></td>
</tr>
<tr class="row-even"><td><p>MemoryAvailable</p></td>
<td><p>host</p></td>
<td><p>MB</p></td>
<td><p>memory available on host</p></td>
</tr>
<tr class="row-odd"><td><p>MemoryUsed</p></td>
<td><p>host</p></td>
<td><p>MB</p></td>
<td><p>memory used on host</p></td>
</tr>
<tr class="row-even"><td><p>MemoryUtilization</p></td>
<td><p>host</p></td>
<td><p>percentage</p></td>
<td><p>memory used on host</p></td>
</tr>
<tr class="row-odd"><td><p>Requests2XX</p></td>
<td><p>host</p></td>
<td><p>count</p></td>
<td><p>logged for every request responded in 200-300 status code range</p></td>
</tr>
<tr class="row-even"><td><p>Requests4XX</p></td>
<td><p>host</p></td>
<td><p>count</p></td>
<td><p>logged for every request responded in 400-500 status code range</p></td>
</tr>
<tr class="row-odd"><td><p>Requests5XX</p></td>
<td><p>host</p></td>
<td><p>count</p></td>
<td><p>logged for every request responded with status code above 500</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id3">
<h2>Formatting<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>The metrics emitted into log files by default, is in a <a class="reference external" href="https://github.com/etsy/statsd">StatsD</a> like format.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CPUUtilization.Percent:0.0<span class="p">|</span><span class="c1">#Level:Host|#hostname:my_machine_name</span>
MemoryUsed.Megabytes:13840.328125<span class="p">|</span><span class="c1">#Level:Host|#hostname:my_machine_name</span>
</pre></div>
</div>
<p>To enable metric logging in JSON format, we can modify the log formatter in <a class="reference external" href="https://github.com/pytorch/serve/blob/master/frontend/server/src/main/resources/log4j.properties">log4j.properties</a>, This is explained in the logging <a class="reference external" href="https://github.com/pytorch/serve/blob/master/docs/logging.md">document</a>.</p>
<p>to enable JSON formatting for metrics change it to</p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="na">log4j.appender.ts_metrics.layout</span> <span class="o">=</span> <span class="s">org.pytorch.serve.util.logging.JSONLayout</span>
</pre></div>
</div>
<p>Once enabled the format emitted to logs, will look as follows</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;MetricName&quot;</span><span class="p">:</span> <span class="s2">&quot;DiskAvailable&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;108.15547180175781&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Gigabytes&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Level&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Host&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;HostName&quot;</span><span class="p">:</span> <span class="s2">&quot;my_machine_name&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;MetricName&quot;</span><span class="p">:</span> <span class="s2">&quot;DiskUsage&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;124.13163757324219&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Gigabytes&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Dimensions&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;Level&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Host&quot;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;HostName&quot;</span><span class="p">:</span> <span class="s2">&quot;my_machine_name&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>Custom Metrics API<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>TorchServe enables the custom service code to emit metrics, that are then logged by the system</p>
<p>The custom service code is provided with a <a class="reference external" href="https://github.com/pytorch/serve/blob/master/ts/context.py">context</a> of the current request.</p>
<p>Which has metrics object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Access context metrics as follows</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">metrics</span>
</pre></div>
</div>
<p>All metrics collected with in the context</p>
<div class="section" id="creating-dimension-object-s">
<h3>Creating dimension object(s)<a class="headerlink" href="#creating-dimension-object-s" title="Permalink to this headline">¶</a></h3>
<p>Dimensions for metrics can be defined as objects</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ts.metrics.dimension</span> <span class="kn">import</span> <span class="n">Dimension</span>

<span class="c1"># Dimensions are name value pairs</span>
<span class="n">dim1</span> <span class="o">=</span> <span class="n">Dimension</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="n">dim2</span> <span class="o">=</span> <span class="n">Dimension</span><span class="p">(</span><span class="n">some_name</span><span class="p">,</span> <span class="n">some_value</span><span class="p">)</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">dimN</span><span class="o">=</span> <span class="n">Dimension</span><span class="p">(</span><span class="n">name_n</span><span class="p">,</span> <span class="n">value_n</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> Metric functions below accept a list of dimensions</p>
</div>
<div class="section" id="add-generic-metrics">
<h3>Add generic metrics<a class="headerlink" href="#add-generic-metrics" title="Permalink to this headline">¶</a></h3>
<p>One can add metrics with generic units using the following function.</p>
<p>Function API</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_metric</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a metric which is generic with custom metrics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        metric name</span>
<span class="sd">    value: int, float</span>
<span class="sd">        value of metric</span>
<span class="sd">    idx: int</span>
<span class="sd">        request_id index in batch</span>
<span class="sd">    unit: str</span>
<span class="sd">        unit of metric</span>
<span class="sd">    dimensions: list</span>
<span class="sd">        list of dimensions for the metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add Distance as a metric</span>
<span class="c1"># dimensions = [dim1, dim2, dim3, ..., dimN]</span>
<span class="c1"># Assuming batch size is 1 for example</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">add_metric</span><span class="p">(</span><span class="s1">&#39;DistanceInKM&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-time-based-metrics">
<h3>Add Time based metrics<a class="headerlink" href="#add-time-based-metrics" title="Permalink to this headline">¶</a></h3>
<p>Time based metrics can be added by invoking the following method</p>
<p>Function API</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a time based metric like latency, default unit is &#39;ms&#39;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        metric name</span>
<span class="sd">    value: int</span>
<span class="sd">        value of metric</span>
<span class="sd">    idx: int</span>
<span class="sd">        request_id index in batch</span>
<span class="sd">    unit: str</span>
<span class="sd">        unit of metric,  default here is ms, s is also accepted</span>
<span class="sd">    dimensions: list</span>
<span class="sd">        list of dimensions for the metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note that the default unit in this case is ‘ms’</p>
<p><strong>Supported units</strong>: [‘ms’, ‘s’]</p>
<p>To add custom time based metrics</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add inference time</span>
<span class="c1"># dimensions = [dim1, dim2, dim3, ..., dimN]</span>
<span class="c1"># Assuming batch size  is 1 for example</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">add_time</span><span class="p">(</span><span class="s1">&#39;InferenceTime&#39;</span><span class="p">,</span> <span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-size-based-metrics">
<h3>Add Size based metrics<a class="headerlink" href="#add-size-based-metrics" title="Permalink to this headline">¶</a></h3>
<p>Size based metrics can be added by invoking the following method</p>
<p>Function API</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_size</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a size based metric</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        metric name</span>
<span class="sd">    value: int, float</span>
<span class="sd">        value of metric</span>
<span class="sd">    idx: int</span>
<span class="sd">        request_id index in batch</span>
<span class="sd">    unit: str</span>
<span class="sd">        unit of metric, default here is &#39;MB&#39;, &#39;kB&#39;, &#39;GB&#39; also supported</span>
<span class="sd">    dimensions: list</span>
<span class="sd">        list of dimensions for the metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note that the default unit in this case is ‘ms’</p>
<p><strong>Supported units</strong>: [‘MB’, ‘kB’, ‘GB’]</p>
<p>To add custom size based metrics</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add Image size as a metric</span>
<span class="c1"># dimensions = [dim1, dim2, dim3, ..., dimN]</span>
<span class="c1"># Assuming batch size is 1 for example</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">add_size</span><span class="p">(</span><span class="s1">&#39;SizeOfImage&#39;</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;MB&#39;</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-percentage-based-metrics">
<h3>Add Percentage based metrics<a class="headerlink" href="#add-percentage-based-metrics" title="Permalink to this headline">¶</a></h3>
<p>Percentage based metrics can be added by invoking the following method</p>
<p>Function API</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_percent</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a percentage based metric</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        metric name</span>
<span class="sd">    value: int, float</span>
<span class="sd">        value of metric</span>
<span class="sd">    idx: int</span>
<span class="sd">        request_id index in batch</span>
<span class="sd">    dimensions: list</span>
<span class="sd">        list of dimensions for the metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>To add custom percentage based metrics</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add MemoryUtilization as a metric</span>
<span class="c1"># dimensions = [dim1, dim2, dim3, ..., dimN]</span>
<span class="c1"># Assuming batch size  is 1 for example</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">add_percent</span><span class="p">(</span><span class="s1">&#39;MemoryUtilization&#39;</span><span class="p">,</span> <span class="n">utilization_percent</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-counter-based-metrics">
<h3>Add Counter based metrics<a class="headerlink" href="#add-counter-based-metrics" title="Permalink to this headline">¶</a></h3>
<p>Percentage based metrics can be added by invoking the following method</p>
<p>Function API</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_counter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a counter metric or increment an existing counter metric</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        metric name</span>
<span class="sd">    value: int</span>
<span class="sd">        value of metric</span>
<span class="sd">    idx: int</span>
<span class="sd">        request_id index in batch</span>
<span class="sd">    dimensions: list</span>
<span class="sd">        list of dimensions for the metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>To create , increment and decrement counter based metrics we can use the following calls</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add Loop Count as a metric</span>
<span class="c1"># dimensions = [dim1, dim2, dim3, ..., dimN]</span>
<span class="c1"># Assuming batch size is 1 for example</span>

<span class="c1"># Create a counter with name &#39;LoopCount&#39; and dimensions, initial value</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">add_counter</span><span class="p">(</span><span class="s1">&#39;LoopCount&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">)</span>

<span class="c1"># Increment counter by 2</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">add_counter</span><span class="p">(</span><span class="s1">&#39;LoopCount&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">)</span>

<span class="c1"># Decrement counter by 1</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">add_counter</span><span class="p">(</span><span class="s1">&#39;LoopCount&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">)</span>

<span class="c1"># Final counter value in this case is 2</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>Logging the custom metrics<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Following sample code can be used to log the custom metrics created in the model’s custom handler:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">store</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;[METRICS]</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">metric</span><span class="p">))</span>
</pre></div>
</div>
<p>This custom metrics information is logged in the model_metrics.log file configured through <a class="reference external" href="https://github.com/pytorch/serve/blob/master/frontend/server/src/main/resources/log4j.properties">log4j.properties</a> file.</p>
</div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rest_api.html" class="btn btn-neutral float-right" title="TorchServe REST API" accesskey="n" rel="next">Next <img src="_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="management_api.html" class="btn btn-neutral" title="Management API" accesskey="p" rel="prev"><img src="_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, PyTorch Serve Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Metrics on TorchServe</a><ul>
<li><a class="reference internal" href="#contents-of-this-document">Contents of this Document</a></li>
<li><a class="reference internal" href="#id1">Introduction</a></li>
<li><a class="reference internal" href="#id2">System Metrics</a></li>
<li><a class="reference internal" href="#id3">Formatting</a></li>
<li><a class="reference internal" href="#id5">Custom Metrics API</a><ul>
<li><a class="reference internal" href="#creating-dimension-object-s">Creating dimension object(s)</a></li>
<li><a class="reference internal" href="#add-generic-metrics">Add generic metrics</a></li>
<li><a class="reference internal" href="#add-time-based-metrics">Add Time based metrics</a></li>
<li><a class="reference internal" href="#add-size-based-metrics">Add Size based metrics</a></li>
<li><a class="reference internal" href="#add-percentage-based-metrics">Add Percentage based metrics</a></li>
<li><a class="reference internal" href="#add-counter-based-metrics">Add Counter based metrics</a></li>
<li><a class="reference internal" href="#id6">Logging the custom metrics</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script type="text/javascript" src="_static/jquery.js"></script>
         <script type="text/javascript" src="_static/underscore.js"></script>
         <script type="text/javascript" src="_static/doctools.js"></script>
         <script type="text/javascript" src="_static/language_data.js"></script>
         <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script>
         <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script>
         <script type="text/javascript" src="_static/katex_autorenderer.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/features">Features</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li>
            <a href="https://pytorch.org/docs/stable/index.html">Docs</a>
          </li>

          <li>
            <a href="https://pytorch.org/resources">Resources</a>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>